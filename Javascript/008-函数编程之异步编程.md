# Javascript 异步编程

## 什么是函数式编程

1. 与数学里的函数运算类比。
2. 函数式编程的特点：避免状态共享和可变数据。
3. 这样做的好处，或者说函数式编程的优点：使得函数的行为变得可预测，适合单元测试。
4. 纯函数：函数的返回结果只收到传入参数的影响，不受其他共享状态的影响，不会有副作用（side effect）。
5. 函数作为参数传入，返回一个新的函数，这种函数也叫做高阶函数。也是函数式编程的一种应用。

## Javascript 异步编程

### 传统的异步编程方案：

1. 回调函数；
2. 事件机制；

### Promise

Promise 是异步编程的一种解决方案; Promise 可以把异步操作用一种链式同步的方式表达出来，避免 callback 回调地狱。Promise 对象本身就是一个构造函数。可以把一个异步回调封装成一个 promise。

Promise 对象有三种状态： pending（进行中），fulfilled（成功） 和 rejected（失败）。

`Promise.resovle()` 函数把 Promise 的状态从 pending -> fulfilled；
`Promise.reject()` 函数把 Promise 的状态从 pending -> failed；

#### 把一个异步函数封装成一个 promise

```js
const timeout = (ms) => {
	return new Promise((resolve, reject) => {
		let success = Math.random() >= 0.5; // 随机true or false
		if (success) {
			resolve(success);
		} else {
			reject("error");
		}
	});
};
function timeIsup(value) {
	console.log("time is up", value);
}

timeout(100).then(timeIsup, (err) => {
	console.log("err", err);
});
```

promise 实例生成之后，可以用 then 方法分别指定 resolved 状态和 rejected 状态的回调函数。
`then()`方法会返回一个新的 promise 实例。

```js
promse.then(
	(result) => {
		// 处理resolved状态：success
	},
	(err) => {
		// 处理rejected状态：failed
	}
);
```

#### Promise.prototype.catch

catch 函数是`then(null, reject)` 的别名。

```js
timeout.then(timeIsup).catch((err) => {
	console.log("catch err", err);
});
```

#### Promise.resolve

将一个现有方法转成 promise 实例，如果参数是一个 promise，将原封不动的返回这个 promise 实例。

![一道经典的红黄绿灯异步调用问题]: (https://www.cnblogs.com/dojo-lzz/p/5495671.html)

### Generator

### Async 和 Await
