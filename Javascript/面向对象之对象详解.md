# Javascript面向对象之对象详解

> 在Javascript语言中，一切皆对象吗？

## 创建对象的三种方法

### 1. 对象字面量

通过对象字面量定义：`var o1 = {x:0, y:0}`
```js
// 第一种方式：字面量
var o1 = { name: 'o1'} // 字面量对象
var o2 = new Object({ name: 'o2'})
```

### 2. 构造函数

通过`new`运算符创建对象，后面跟随一个函数调用，此函数叫构造函数。

```js
var o2 = new Object();
var o2 = new Array();
var o2 = new Date();
// 第二种方式：通过函数 + new运算符创建
var M = function() { this.name='o3'}  //函数在声明的时候，JS引擎会给这个函数自动加上prototype.
console.log(M.prototype.constructor === M) // true
var o3 = new M() // 任何一个函数，只要被new使用了，这个函数就会变成创建对象的构造函数
console.log(o3.__proto__ === M.prototype) // true
console.log(o3 instanceof M) //true
console.log(o3 instanceof Object) //true
console.log(o3.__proto__ === M.prototype)
```

### 3. Object.create方法

通过祖先对象`Object.create(func.prototype or object.__proto__)`创建出来；

`Object.create` 创建的对象本身是个空对象，是用原型链来连接的，不会执行函数的构造函数。

```js
var p = {name: 'o3'}
var o4 = Object.create(p) // o4.__proto__ === p.__proto__ => true
```

## new运算符

new foo() 执行过程：
1. 一个新实例对象被创建，继承自foo.prototype。
2. foo.constructor() 构造函数foo被执行，传入参数，上下文this会被指定为这个新的实例对象。
3. 如果构造函数返回了一个对象，那么这个对象会取代整个new出来的结果，如果构造函数没有返回对象，则new出来的实例对象为步骤1创建的对象。

### 模拟new运算符

通过`Object.create` 和call函数来实现`new`运算符模拟；

```js
var new2 = function(func) {
    // 根据函数的原型创建一个对象
    var o = Object.create(func.prototype)
    // 执行func.prototype的构造函数func
    var k = func.call(o) 
    if(typeof k === 'object') {
        return k
    } else {
        return o
    }
}
```

## 对象的属性

### 查询属性

通过`.` 和 `[]`运算符查询属性；

`[]`运算符接受一个表达式，表达式的计算结果必须为字符串；

### 删除属性

`delete`运算符可以删除属性；

delete运算符只能删除自由属性，不能删除继承属性；

delete运算符不能删除那些可配置属性为false的属性；

```js
`delete window.xxxxx`;
```

### 检测属性

检测属性三种方法：
1. `in` 运算符: 如果对象的自有属性或继承属性中包含这个属性则返回true；
2. `hasOwnProperty()`: 检测是否是对象的自有属性；
3. `propertyIsEnumerable()`: 检测是否是对象的可枚举的自有属性；

> 通常，代码中给对象添加的属性默认都是可枚举的，除非通过`defineProperty`强制设定成不可枚举的属性。

### 枚举属性

`for/in` 循环可以遍历对象中所有可枚举的属性，包括自有属性和继承的属性。对象继承的内置方法，如`toString()`等，不可枚举的方法不会被`for/in`遍历出来。

`Object.keys()`返回可枚举的自有属性，不包含继承的属性，`JSON.stringify()`返回的是自身可枚举属性的字符串。

#### 属性拷贝与合并

[代码地址 extend.js](../Code/Javascript/extend.js)

### 属性特性 

属性的特性也叫做装饰器Descriptor。

![property_descriptor](../Images/Javascript/object_get_set.png)

对象的属性包含一个名字和四个特性: 
1. 键: key 和 值: value, 可读性由get方法存在与否决定；
2. 可写性: writable, 可写性是由set方法存在与否决定；
3. 可枚举: enumerable; 
4. 可配置: configurable;

`Object.getOwnPropertyDescriptor()`返回某个对象特定属性的属性描述符；

```js
Object.getOwnPropertyDescriptor({x: 1}, "x");

var o = {};
Object.defineProperty(o, "x", {
    value: 1,
    writable: true,
    enumerable: false, // 设置成不可枚举，当成内置属性
    configurable: true
});
```

#### 通过get和set函数实现简单的mvvm框架

[代码地址 mvvm.js](../Code/Javascript/mvvm.js)


