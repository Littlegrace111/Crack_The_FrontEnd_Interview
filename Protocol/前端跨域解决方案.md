# 前端跨域解决方案

## 跨域定义
1. 资源跳转： <a>link</a>、重定向、表单提交；
2. 资源嵌入：`<link>`, `<script>`, `<img>`,  `<iframe>`等dom标签，还有样式中`background:url()`, `@font-face()`等文件外链；
3. 脚本请求：js发起的ajax请求，dom和js对象的跨域操作等；

## 同源策略 （Same Origin Policy）
1. 由浏览器控制的核心安全功能，避免浏览器受到XSS、CSFR等攻击，是一个用于隔离潜在恶意文件的关键安全机制；
2. 同源是指：“协议+域名+端口”三者相同；
3. 不是一个源的文档：Cookie，LocalStorage, IndexDB 无法读取， DOM无法读取，AJAX请求无法发送；
4. 前后端通信方式：Ajax 和 Websocket， CORS

### 同源策略限制以下几个行为
1. Cookie，LocalStorage和IndexDB无法读取；
2. DOM 和JS对象无法获得；
3. AJAX 请求不能发送；

## 跨域解决方案
### 1. JSONP
> 为了减轻web服务器的负载，通常把js，css，img等静态文件分离到另一台独立域名的服务器上，在html页面中再通过相应标签从不同域名下加载静态资源，这种操作被浏览器允许。

jsonp跨域原理：允许在服务端集成Script tags返回至客户端，通过javascript callback的形式实现跨域访问。
jsonp只能使用Get请求，不提供错误处理，如果返回失败，什么都不会发生，无法获得一个404错误，也不能取消这个请求。
json另一个重要缺点是，如果使用了不信任的服务器会造成很大的安全隐患。

服务器的回调函数, 默认为callback, 如果不取名字，会随即生成。

### 2. Hash - iframe


### 3. WebSocket

### 4. postMessage(HTML5 新增)

### 5. 跨域资源共享 CORS
**普通的跨域请求：**   
浏览器发送`XMLHttpRequest`会默认在header中添加Origin字段，只要服务端在response header中返回Access-control-Allow-Origin即可，浏览器即认为服务端同意CORS请求；
普通跨域请求，前端无需设置，若要带cookie请求，前后端都需要设置；
**携带cookie和HTTP认证的跨域请求：**  
浏览器发送`withCredentials`属性，服务器必须返回`Access-Control-Allow-Credentials`。
[阮一峰的cors跨域教程]http://www.ruanyifeng.com/blog/2016/04/cors.html

```js
fetch('/some/url', {
    method: 'get'
}).then(response => {

}).catch(error => {

})
```


